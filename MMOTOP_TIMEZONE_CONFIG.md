# Настройка часового пояса MMOTOP

## Проблема
Разные часовые пояса между пользователем и сайтом mmotop могут приводить к неправильному засчитыванию голосов.

## Решение
Теперь система использует время mmotop как точку отсчета, а не локальное время сервера.

## Настройка

### 1. Добавьте в .env файл:
```env
# Часовой пояс mmotop (по умолчанию UTC)
MMOTOP_TIMEZONE=UTC

# Или для конкретного часового пояса:
# MMOTOP_TIMEZONE=Europe/Moscow
# MMOTOP_TIMEZONE=America/New_York
# MMOTOP_TIMEZONE=Asia/Tokyo
```

### 2. Определите часовой пояс mmotop
- Проверьте в логах mmotop какое время там указано
- Сравните с вашим локальным временем
- Установите правильный часовой пояс

### 3. Примеры часовых поясов:
- `UTC` - Всемирное координированное время
- `Europe/Moscow` - Московское время (UTC+3)
- `Europe/London` - Лондонское время (UTC+0/+1)
- `America/New_York` - Восточное время США (UTC-5/-4)
- `Asia/Tokyo` - Японское время (UTC+9)

## Как это работает

1. **Парсинг времени mmotop**: Время из файла mmotop парсится в указанном часовом поясе
2. **Сравнение с последним голосом**: Используется время mmotop для определения новых голосов
3. **Сохранение времени**: Время голоса сохраняется как время mmotop, а не локальное время сервера
4. **Таймер голосования**: Таймер работает по времени mmotop, обновляется каждую минуту
5. **Логирование**: В логах указывается время mmotop для отладки

## Таймер голосования

### Обновление в 00:01 по времени mmotop
- Таймер сбрасывается в 00:01 по времени mmotop (не по локальному времени сервера)
- Голосовать можно раз в сутки по времени mmotop
- JavaScript обновляет таймер каждую минуту через AJAX

### Настройка таймера
```env
# Часовой пояс mmotop для таймера
MMOTOP_TIMEZONE=UTC

# Кулдаун голосования в часах
VOTE_COOLDOWN_HOURS=24
```

### JavaScript файлы
- `assets/js/vote-timer.js` - автоматическое обновление таймера
- `assets/js/vote-notification.js` - уведомления о голосовании

## Отладка

Проверьте логи в `storage/logs/laravel.log` для сообщений:
- `Failed to parse vote timestamp` - ошибки парсинга времени
- `MMOTOP Time: [время]` - время mmotop в логах активности

## Миграция существующих данных

Если у вас уже есть голоса в базе данных, они останутся с прежним временем.
Новые голоса будут использовать время mmotop.
